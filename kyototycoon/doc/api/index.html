<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kyoto Tycoon: Kyoto Tycoon: a handy cache/storage server</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kyoto Tycoon
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Kyoto Tycoon: a handy cache/storage server </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="Introduction"></a>
Introduction</h2>
<p>Kyoto Tycoon is a lightweight database server with auto expiration mechanism, which is useful to handle cache data and persistent data of various applications. Kyoto Tycoon is also a package of network interface to the DBM called Kyoto Cabinet. Though the DBM has high performance and high concurrency, you might bother in case that multiple processes share the same database, or remote processes access the database. Thus, Kyoto Tycoon is provided for concurrent and remote connections to Kyoto Cabinet. Kyoto Tycoon is composed of the server process managing multiple databases and its access library for client applications.</p>
<p>The network protocol between the server and clients is HTTP so that you can write client applications and client libraries in almost all popular languages. Both of RESTful-style interface by the GET, HEAD, PUT, DELETE methods and RPC-style inteface by the POST method are supported. The server can handle more than 10 thousand connections at the same time because it uses modern I/O event notification facilities such as "epoll" and "kqueue" of underlying systems. The server can embed Lua, a lightweight script language so that you can define arbitrary operations of the database.</p>
<p>The following classes are the most important. If you are interested in writing applications of Kyoto Tycoon, all you have to learn is how to use the remote database interface.</p>
<ul>
<li><a class="el" href="classkyototycoon_1_1RemoteDB.html" title="Remote database.">kyototycoon::RemoteDB</a> -- remote database interface</li>
</ul>
<ul>
<li><a class="el" href="classkyototycoon_1_1TimedDB.html" title="Timed database.">kyototycoon::TimedDB</a> -- database implementation with record expiration mechanism </li>
<li><a class="el" href="classkyototycoon_1_1RPCClient.html" title="RPC client.">kyototycoon::RPCClient</a> -- utilities to implement your own RPC client </li>
<li><a class="el" href="classkyototycoon_1_1RPCServer.html" title="RPC server.">kyototycoon::RPCServer</a> -- utilities to implement your own RPC server </li>
<li><a class="el" href="classkyototycoon_1_1HTTPClient.html" title="HTTP client.">kyototycoon::HTTPClient</a> -- utilities to implement your own HTTP client </li>
<li><a class="el" href="classkyototycoon_1_1HTTPServer.html" title="HTTP server.">kyototycoon::HTTPServer</a> -- utilities to implement your own HTTP server </li>
<li><a class="el" href="classkyototycoon_1_1ThreadedServer.html" title="Threaded TCP Server.">kyototycoon::ThreadedServer</a> -- utilities to implement your own TCP server </li>
<li><a class="el" href="classkyototycoon_1_1Poller.html" title="I/O event notification.">kyototycoon::Poller</a> -- abstraction of system-independent event notification mechanism </li>
<li><a class="el" href="classkyototycoon_1_1Socket.html" title="Network stream abstraction based on TCP/IP.">kyototycoon::Socket</a> -- abstraction of system-independent client socket mechanism </li>
<li><a class="el" href="classkyototycoon_1_1ServerSocket.html" title="Network server abstraction based on TCP/IP.">kyototycoon::ServerSocket</a> -- abstraction of system-independent server socket mechanism </li>
<li><a class="el" href="classkyototycoon_1_1PluggableServer.html" title="Interface of pluggable server abstraction.">kyototycoon::PluggableServer</a> -- pluggable server interface </li>
<li><a class="el" href="classkyototycoon_1_1PluggableDB.html" title="Interface of pluggable database abstraction.">kyototycoon::PluggableDB</a> -- pluggable database interface</li>
</ul>
<h2><a class="anchor" id="Example"></a>
Example</h2>
<p>The following code is an example to use a remote database.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="ktremotedb_8h.html" title="remote database">ktremotedb.h</a>&gt;</span>

<span class="keyword">using namespace </span>std;
<span class="keyword">using namespace </span>kyototycoon;

<span class="comment">// main routine</span>
<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {

  <span class="comment">// create the database object</span>
  <a class="code" href="classkyototycoon_1_1RemoteDB.html" title="Remote database.">RemoteDB</a> db;

  <span class="comment">// open the database</span>
  <span class="keywordflow">if</span> (!db.<a class="code" href="classkyototycoon_1_1RemoteDB.html#a08f2314a62af09137aecf2d4d6a1dbaf" title="Open the connection.">open</a>()) {
    cerr &lt;&lt; <span class="stringliteral">&quot;open error: &quot;</span> &lt;&lt; db.<a class="code" href="classkyototycoon_1_1RemoteDB.html#a5b22c48e3a3a060950ef0bc3baf0a809" title="Get the last happened error code.">error</a>().<a class="code" href="classkyototycoon_1_1RemoteDB_1_1Error.html#ace5ab04e81f44bc5c2033a69a811bf51" title="Get the readable string of the code.">name</a>() &lt;&lt; endl;
  }

  <span class="comment">// store records</span>
  <span class="keywordflow">if</span> (!db.<a class="code" href="classkyototycoon_1_1RemoteDB.html#ab232dfb1947a94d7a92782d52dd0c67d" title="Set the value of a record.">set</a>(<span class="stringliteral">&quot;foo&quot;</span>, <span class="stringliteral">&quot;hop&quot;</span>) ||
      !db.<a class="code" href="classkyototycoon_1_1RemoteDB.html#ab232dfb1947a94d7a92782d52dd0c67d" title="Set the value of a record.">set</a>(<span class="stringliteral">&quot;bar&quot;</span>, <span class="stringliteral">&quot;step&quot;</span>) ||
      !db.<a class="code" href="classkyototycoon_1_1RemoteDB.html#ab232dfb1947a94d7a92782d52dd0c67d" title="Set the value of a record.">set</a>(<span class="stringliteral">&quot;baz&quot;</span>, <span class="stringliteral">&quot;jump&quot;</span>)) {
    cerr &lt;&lt; <span class="stringliteral">&quot;set error: &quot;</span> &lt;&lt; db.<a class="code" href="classkyototycoon_1_1RemoteDB.html#a5b22c48e3a3a060950ef0bc3baf0a809" title="Get the last happened error code.">error</a>().<a class="code" href="classkyototycoon_1_1RemoteDB_1_1Error.html#ace5ab04e81f44bc5c2033a69a811bf51" title="Get the readable string of the code.">name</a>() &lt;&lt; endl;
  }

  <span class="comment">// retrieve a record</span>
  <span class="keywordtype">string</span> value;
  <span class="keywordflow">if</span> (db.<a class="code" href="classkyototycoon_1_1RemoteDB.html#acd063776b8998ab74365b76d64c65fd5" title="Retrieve the value of a record.">get</a>(<span class="stringliteral">&quot;foo&quot;</span>, &amp;value)) {
    cout &lt;&lt; value &lt;&lt; endl;
  } <span class="keywordflow">else</span> {
    cerr &lt;&lt; <span class="stringliteral">&quot;get error: &quot;</span> &lt;&lt; db.<a class="code" href="classkyototycoon_1_1RemoteDB.html#a5b22c48e3a3a060950ef0bc3baf0a809" title="Get the last happened error code.">error</a>().<a class="code" href="classkyototycoon_1_1RemoteDB_1_1Error.html#ace5ab04e81f44bc5c2033a69a811bf51" title="Get the readable string of the code.">name</a>() &lt;&lt; endl;
  }

  <span class="comment">// traverse records</span>
  <a class="code" href="classkyototycoon_1_1RemoteDB_1_1Cursor.html" title="Cursor to indicate a record.">RemoteDB::Cursor</a>* cur = db.<a class="code" href="classkyototycoon_1_1RemoteDB.html#ae64153e9e304d6b178ad7daa502bbfe3" title="Create a cursor object.">cursor</a>();
  cur-&gt;<a class="code" href="classkyototycoon_1_1RemoteDB_1_1Cursor.html#a063e7d2447cf42a084a362e665e9ebc5" title="Jump the cursor to the first record for forward scan.">jump</a>();
  <span class="keywordtype">string</span> ckey, cvalue;
  <span class="keywordflow">while</span> (cur-&gt;<a class="code" href="classkyototycoon_1_1RemoteDB_1_1Cursor.html#aeb882deaa1a99d1b80d00d1959bfbf66" title="Get a pair of the key and the value of the current record.">get</a>(&amp;ckey, &amp;cvalue, NULL, <span class="keyword">true</span>)) {
    cout &lt;&lt; ckey &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; cvalue &lt;&lt; endl;
  }
  <span class="keyword">delete</span> cur;

  <span class="comment">// close the database</span>
  <span class="keywordflow">if</span> (!db.<a class="code" href="classkyototycoon_1_1RemoteDB.html#ae440d3dd2e4e0696138c10e015b4d375" title="Close the connection.">close</a>()) {
    cerr &lt;&lt; <span class="stringliteral">&quot;close error: &quot;</span> &lt;&lt; db.<a class="code" href="classkyototycoon_1_1RemoteDB.html#a5b22c48e3a3a060950ef0bc3baf0a809" title="Get the last happened error code.">error</a>().<a class="code" href="classkyototycoon_1_1RemoteDB_1_1Error.html#ace5ab04e81f44bc5c2033a69a811bf51" title="Get the readable string of the code.">name</a>() &lt;&lt; endl;
  }

  <span class="keywordflow">return</span> 0;
}
</pre></div><p>The following code is an example to use the TCP server framework.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="ktthserv_8h.html" title="threaded server">ktthserv.h</a>&gt;</span>

<span class="keyword">using namespace </span>std;
<span class="keyword">using namespace </span>kyototycoon;

<span class="comment">// the flag whether the server is alive</span>
<a class="code" href="classkyototycoon_1_1ThreadedServer.html" title="Threaded TCP Server.">ThreadedServer</a>* g_serv = NULL;

<span class="comment">// stop the running server</span>
<span class="keyword">static</span> <span class="keywordtype">void</span> stopserver(<span class="keywordtype">int</span> signum) {
  <span class="keywordflow">if</span> (g_serv) g_serv-&gt;<a class="code" href="classkyototycoon_1_1ThreadedServer.html#a1130ff783c68a6654ea3c1631060ad34" title="Stop the service.">stop</a>();
  g_serv = NULL;
}

<span class="comment">// main routine</span>
<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {

  <span class="comment">// set the signal handler to stop the server</span>
  <a class="code" href="namespacekyototycoon.html#a9ab27b9ecf56eedb045b412ef741d40e" title="Set the signal handler for termination signals.">setkillsignalhandler</a>(stopserver);

  <span class="comment">// prepare the worker</span>
  <span class="keyword">class </span>Worker : <span class="keyword">public</span> <a class="code" href="classkyototycoon_1_1ThreadedServer.html" title="Threaded TCP Server.">ThreadedServer</a>::Worker {
    <span class="keywordtype">bool</span> process(<a class="code" href="classkyototycoon_1_1ThreadedServer.html" title="Threaded TCP Server.">ThreadedServer</a>* serv, <a class="code" href="classkyototycoon_1_1ThreadedServer_1_1Session.html" title="Interface to access each session data.">ThreadedServer::Session</a>* sess) {
      <span class="keywordtype">bool</span> keep = <span class="keyword">false</span>;
      <span class="comment">// read a line from the client socket</span>
      <span class="keywordtype">char</span> line[1024];
      <span class="keywordflow">if</span> (sess-&gt;<a class="code" href="classkyototycoon_1_1Socket.html#aeb68a22d86a3f7c60ce3b5078c2be0ef" title="Receive one line of characters.">receive_line</a>(line, <span class="keyword">sizeof</span>(line))) {
        <span class="keywordflow">if</span> (!kc::stricmp(line, <span class="stringliteral">&quot;/quit&quot;</span>)) {
          <span class="comment">// process the quit command</span>
          sess-&gt;<a class="code" href="classkyototycoon_1_1Socket.html#aa8445db356fcb745d5c249b42c900956" title="Send formatted data.">printf</a>(<span class="stringliteral">&quot;&gt; Bye!\n&quot;</span>);
        } <span class="keywordflow">else</span> {
          <span class="comment">// echo back the message</span>
          sess-&gt;<a class="code" href="classkyototycoon_1_1Socket.html#aa8445db356fcb745d5c249b42c900956" title="Send formatted data.">printf</a>(<span class="stringliteral">&quot;&gt; %s\n&quot;</span>, line);
          keep = <span class="keyword">true</span>;
        }
      }
      <span class="keywordflow">return</span> keep;
    }
  };
  Worker worker;

  <span class="comment">// prepare the server</span>
  <a class="code" href="classkyototycoon_1_1ThreadedServer.html" title="Threaded TCP Server.">ThreadedServer</a> serv;
  serv.<a class="code" href="classkyototycoon_1_1ThreadedServer.html#a777ab18229924e1321f91ba864f48acf" title="Set the network configurations.">set_network</a>(<span class="stringliteral">&quot;127.0.0.1:1978&quot;</span>, 1.0);
  serv.<a class="code" href="classkyototycoon_1_1ThreadedServer.html#ae8654f51748e8837401a7934deb872dd" title="Set the worker to process each request.">set_worker</a>(&amp;worker, 4);
  g_serv = &amp;serv;

  <span class="comment">// start the server and block until its stop</span>
  serv.<a class="code" href="classkyototycoon_1_1ThreadedServer.html#aa1ebc9660d182816d60495b449531319" title="Start the service.">start</a>();

  <span class="comment">// clean up connections and other resources</span>
  serv.<a class="code" href="classkyototycoon_1_1ThreadedServer.html#a3136d88ca8ea15d0d548d2147cf9af1e" title="Finish the service.">finish</a>();

  <span class="keywordflow">return</span> 0;
}
</pre></div> </div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Fri May 25 2012 02:44:32 for Kyoto Tycoon by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
